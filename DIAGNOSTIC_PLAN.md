# üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–π –ø–ª–∞–Ω –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

## –ü—Ä–æ–±–ª–µ–º–∞:
```
500 Error ‚Üí "–ù–µ–≤–µ—Ä–Ω—ã–π –∏–ª–∏ –∏—Å—Ç–µ–∫—à–∏–π —Ç–æ–∫–µ–Ω"
```

## –¶–µ–ø–æ—á–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:
```
1. –Æ–∑–µ—Ä ‚Üí /start –≤ –±–æ—Ç–µ
2. –ë–æ—Ç ‚Üí RPC –≤—ã–∑–æ–≤ generate_auth_token –≤ Supabase
3. Supabase ‚Üí –°–æ–∑–¥–∞–µ—Ç –∑–∞–ø–∏—Å—å –≤ auth_tokens
4. –ë–æ—Ç ‚Üí –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å—Å—ã–ª–∫—É —Å —Ç–æ–∫–µ–Ω–æ–º
5. –§—Ä–æ–Ω—Ç ‚Üí –í—ã—Ç–∞—Å–∫–∏–≤–∞–µ—Ç token –∏–∑ URL
6. –§—Ä–æ–Ω—Ç ‚Üí POST /api/auth/verify-token —Å —Ç–æ–∫–µ–Ω–æ–º
7. API ‚Üí –ò—â–µ—Ç —Ç–æ–∫–µ–Ω –≤ auth_tokens
8. API ‚Üí –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å user + session
9. –§—Ä–æ–Ω—Ç ‚Üí –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Å–µ—Å—Å–∏—é –∏ —Ä–µ–¥–∏—Ä–µ–∫—Ç–∏—Ç
```

## –®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä–∏–º —á—Ç–æ –≤–æ–æ–±—â–µ —Å–æ–∑–¥–∞—é—Ç—Å—è —Ç–æ–∫–µ–Ω—ã?

–í—ã–ø–æ–ª–Ω–∏—Ç–µ —ç—Ç–æ—Ç SQL –≤ Supabase Dashboard ‚Üí SQL Editor:

```sql
-- –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–∞–±–ª–∏—Ü—É auth_tokens
SELECT 
  token,
  telegram_id,
  used,
  expires_at,
  created_at,
  (expires_at > NOW()) as is_not_expired,
  EXTRACT(EPOCH FROM (expires_at - NOW())) as seconds_until_expiry
FROM auth_tokens
ORDER BY created_at DESC
LIMIT 5;
```

**–û–∂–∏–¥–∞–µ–º —É–≤–∏–¥–µ—Ç—å:**
- –ü–æ—Å–ª–µ–¥–Ω–∏–µ 5 —Ç–æ–∫–µ–Ω–æ–≤
- –£ –Ω–∏—Ö –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Ä–∞–∑–Ω—ã–µ telegram_id
- expires_at –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤ –±—É–¥—É—â–µ–º
- used –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å false (–ø–æ–∫–∞ –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω—ã)

---

## –®–∞–≥ 2: –ï—Å–ª–∏ —Ç–æ–∫–µ–Ω—ã –ï–°–¢–¨ - –ø—Ä–æ–≤–µ—Ä–∏–º —á—Ç–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç API

–°–∫–æ–ø–∏—Ä—É–π—Ç–µ –õ–Æ–ë–û–ô —Ç–æ–∫–µ–Ω –∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –≤—ã—à–µ (—Å–∞–º—ã–π —Å–≤–µ–∂–∏–π) –∏ –≤—Å—Ç–∞–≤—å—Ç–µ —Å—é–¥–∞:

```bash
curl -v -X POST "https://outliviondashboard.vercel.app/api/auth/verify-token" \
  -H "Content-Type: application/json" \
  -d '{"token":"–í–ê–®_–¢–û–ö–ï–ù_–û–¢–°–Æ–î–ê"}'
```

**–û–∂–∏–¥–∞–µ–º —É–≤–∏–¥–µ—Ç—å:**
- –ü–æ–ª–Ω—ã–π HTTP –æ—Ç–≤–µ—Ç
- Status 200 –µ—Å–ª–∏ —É—Å–ø–µ—Ö
- Status 500 –µ—Å–ª–∏ –æ—à–∏–±–∫–∞ - –∏ –ü–û–ß–ï–ú–£ –≤ –¥–µ—Ç–∞–ª–∏

---

## –®–∞–≥ 3: –ï—Å–ª–∏ —Ç–æ–∫–µ–Ω—ã –ù–ï —Å–æ–∑–¥–∞—é—Ç—Å—è - –ø—Ä–æ–≤–µ—Ä–∏–º –±–æ—Ç

–í—ã–ø–æ–ª–Ω–∏—Ç–µ –≤ –±–æ—Ç–µ:
```
/start
```

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –±–æ—Ç–∞:
```bash
tail -50 /Users/outcasts/Documents/outlivion-dashboard/telegram-bot/bot.log
```

**–ò—â–µ–º:**
- –û—à–∏–±–∫–∏ –ø—Ä–∏ –≤—ã–∑–æ–≤–µ generate_auth_token
- –û—à–∏–±–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Supabase
- Exception –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ç–æ–∫–µ–Ω–∞

---

## –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä–∏–º —Å–∞–º—É —Ñ—É–Ω–∫—Ü–∏—é generate_auth_token

–í—ã–ø–æ–ª–Ω–∏—Ç–µ –≤ Supabase SQL Editor:

```sql
-- –ü—ã—Ç–∞–µ–º—Å—è –≤—ã–∑–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é –Ω–∞–ø—Ä—è–º—É—é
SELECT * FROM generate_auth_token(782245481);
```

**–û–∂–∏–¥–∞–µ–º:**
- JSON —Å success: true
- token: "–∫–∞–∫–æ–π-—Ç–æ UUID"
- auth_url: "—Å—Å—ã–ª–∫–∞"
- expires_at: timestamp

–ï—Å–ª–∏ –æ—à–∏–±–∫–∞ - –∑–Ω–∞—á–∏—Ç –ø—Ä–æ–±–ª–µ–º–∞ –≤ —Å–∞–º–æ–π —Ñ—É–Ω–∫—Ü–∏–∏.

---

## –ß–µ–∫-–ª–∏—Å—Ç:

- [ ] –¢–æ–∫–µ–Ω—ã —Å–æ–∑–¥–∞—é—Ç—Å—è? (–®–∞–≥ 1)
- [ ] –§—É–Ω–∫—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç? (–®–∞–≥ 4)
- [ ] –ë–æ—Ç –Ω–µ –æ—à–∏–±–∞–µ—Ç—Å—è? (–®–∞–≥ 3)
- [ ] API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 500? (–®–∞–≥ 2)
- [ ] –ï—Å–ª–∏ 500 - –∫–∞–∫–∞—è –ö–û–ù–ö–†–ï–¢–ù–û –æ—à–∏–±–∫–∞ –≤ –¥–µ—Ç–∞–ª—è—Ö?

**–û–¢–í–ï–¢–¨–¢–ï –Ω–∞ —ç—Ç–∏ –≤–æ–ø—Ä–æ—Å—ã –∏ —è –±—É–¥—É –∑–Ω–∞—Ç—å –≥–¥–µ –∏–º–µ–Ω–Ω–æ –ø—Ä–æ–±–ª–µ–º–∞!**

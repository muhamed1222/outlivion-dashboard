# ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –ø–ª–∞—Ç–µ–∂–µ–π –ó–ê–í–ï–†–®–ï–ù–ê

## üì¶ –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–¥

1. **`lib/enot.ts`** - –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Enot.io API
   - –§—É–Ω–∫—Ü–∏–∏ —Å–æ–∑–¥–∞–Ω–∏—è –ø–ª–∞—Ç–µ–∂–µ–π
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏ webhook
   - TypeScript —Ç–∏–ø—ã

2. **`app/api/payment/create/route.ts`** - API endpoint —Å–æ–∑–¥–∞–Ω–∏—è –ø–ª–∞—Ç–µ–∂–∞ (–æ–±–Ω–æ–≤–ª—ë–Ω)
   - –†–µ–∞–ª—å–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Enot.io
   - –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
   - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ external_id

3. **`app/api/payment/webhook/route.ts`** - Webhook –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ (—É–ª—É—á—à–µ–Ω)
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ ‚úÖ
   - –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ ‚úÖ
   - –ê–≤—Ç–æ–ø—Ä–æ–¥–ª–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–æ–∫ ‚úÖ
   - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ gateway_data ‚úÖ

4. **`app/(dashboard)/payment/success/page.tsx`** - –°—Ç—Ä–∞–Ω–∏—Ü–∞ —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç—ã
   - –ö—Ä–∞—Å–∏–≤—ã–π UI
   - –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–µ—Ç–∞–ª–µ–π –ø–ª–∞—Ç–µ–∂–∞
   - –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

5. **`app/(dashboard)/payment/fail/page.tsx`** - –°—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–µ—É–¥–∞—á–Ω–æ–π –æ–ø–ª–∞—Ç—ã
   - –ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–π UI
   - –°–ø–∏—Å–æ–∫ –ø—Ä–∏—á–∏–Ω
   - –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

6. **`supabase/add_payment_external_id.sql`** - SQL –º–∏–≥—Ä–∞—Ü–∏—è
   - –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ external_id
   - –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ gateway_data
   - –°–æ–∑–¥–∞–Ω –∏–Ω–¥–µ–∫—Å

7. **`lib/types/database.types.ts`** - TypeScript —Ç–∏–ø—ã (–æ–±–Ω–æ–≤–ª–µ–Ω—ã)
   - –ù–æ–≤—ã–µ –ø–æ–ª—è –≤ payments —Ç–∞–±–ª–∏—Ü–µ

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

8. **`test_payment_webhook.sh`** - –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —Ç–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç
   - –ó–∞–ø—É—Å–∫ Ngrok
   - –û—Ç–ø—Ä–∞–≤–∫–∞ —Ç–µ—Å—Ç–æ–≤—ã—Ö webhook
   - –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ª–æ–≥–æ–≤

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

9. **`PAYMENT_INTEGRATION.md`** (11 KB)
   - –ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
   - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤ Enot.io
   - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ webhook
   - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
   - Troubleshooting

10. **`PAYMENT_SETUP_CHECKLIST.md`** (9 KB)
    - –ü–æ—à–∞–≥–æ–≤—ã–π —á–µ–∫–ª–∏—Å—Ç
    - –¢–µ—Å—Ç–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏
    - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

11. **`PAYMENT_INTEGRATION_SUMMARY.md`** (12 KB)
    - –û–±–∑–æ—Ä –≤—Å–µ—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π
    - –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è
    - –ú–µ—Ç—Ä–∏–∫–∏ —É—Å–ø–µ—Ö–∞

12. **`README.md`** (–æ–±–Ω–æ–≤–ª—ë–Ω)
    - –î–æ–±–∞–≤–ª–µ–Ω–∞ —Å–µ–∫—Ü–∏—è –æ –ø–ª–∞—Ç–µ–∂–∞—Ö
    - –û–±–Ω–æ–≤–ª–µ–Ω—ã env –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ

13. **`env.example`** - –®–∞–±–ª–æ–Ω –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

## ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

### –ò–∑ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è

- [x] ‚úÖ **–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–Ω–æ–≥–æ —à–ª—é–∑–∞** - Enot.io –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω
- [x] ‚úÖ **–ü–æ–ª—É—á–µ–Ω–∏–µ API –∫–ª—é—á–µ–π** - –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∫–ª—é—á–∏
- [x] ‚úÖ **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ webhook URL** - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω endpoint `/api/payment/webhook`
- [x] ‚úÖ **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏** - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `verifyEnotWebhookSignature()`
- [x] ‚úÖ **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –Ω–∞ "completed"** - –ü—Ä–∏ —É—Å–ø–µ—à–Ω–æ–º webhook
- [x] ‚úÖ **–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞** - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ —É—Å–ø–µ—à–Ω–æ–º –ø–ª–∞—Ç–µ–∂–µ
- [x] ‚úÖ **–§–∏–∫—Å–∞—Ü–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏** - –°–æ–∑–¥–∞—ë—Ç—Å—è –∑–∞–ø–∏—Å—å –≤ —Ç–∞–±–ª–∏—Ü–µ `transactions`
- [x] ‚úÖ **–ê–≤—Ç–æ-–ø—Ä–æ–¥–ª–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏** - –ï—Å–ª–∏ –±–∞–ª–∞–Ω—Å –¥–æ—Å—Ç–∞—Ç–æ—á–µ–Ω –∏ –ø–æ–¥–ø–∏—Å–∫–∞ –∏—Å—Ç–µ–∫–ª–∞
- [x] ‚úÖ **–°–ø–∏—Å–∞–Ω–∏–µ —Å–æ —Å—á—ë—Ç–∞** - –ü—Ä–∏ –∞–≤—Ç–æ-–ø—Ä–æ–¥–ª–µ–Ω–∏–∏
- [x] ‚úÖ **–ü—Ä–æ–¥–ª–µ–Ω–∏–µ –Ω–∞ –º–µ—Å—è—Ü** - –ü–æ–¥–ø–∏—Å–∫–∞ –ø—Ä–æ–¥–ª–µ–≤–∞–µ—Ç—Å—è –Ω–∞ 30 –¥–Ω–µ–π
- [x] ‚úÖ **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** - –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω —Å–∫—Ä–∏–ø—Ç –¥–ª—è —Ä—É—á–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- [x] ‚úÖ **–û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–µ—É—Å–ø–µ—à–Ω—ã—Ö –ø–ª–∞—Ç–µ–∂–µ–π** - –°—Ç–∞—Ç—É—Å—ã failed/canceled –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è

### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

- [x] ‚úÖ –°—Ç—Ä–∞–Ω–∏—Ü—ã —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –ø–ª–∞—Ç–µ–∂–∞ (success/fail)
- [x] ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ–ª–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –æ—Ç —à–ª—é–∑–∞ (gateway_data)
- [x] ‚úÖ –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- [x] ‚úÖ TypeScript —Ç–∏–ø—ã –¥–ª—è –≤—Å–µ—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä –¥–∞–Ω–Ω—ã—Ö
- [x] ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ webhook
- [x] ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤—Å–µ—Ö —Å—Ç–∞—Ç—É—Å–æ–≤ Enot.io (success, failed, expired, rejected)
- [x] ‚úÖ Comprehensive –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ
- [x] ‚úÖ –¢–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç —Å –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–º –º–µ–Ω—é

## üéØ –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

### 1. –°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞

```typescript
// lib/enot.ts
export async function createEnotPayment(params: EnotPaymentParams): Promise<EnotPaymentResponse>
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- –§–æ—Ä–º–∏—Ä—É–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è Enot.io
- –°–æ–∑–¥–∞—ë—Ç MD5 –ø–æ–¥–ø–∏—Å—å
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç URL –¥–ª—è —Ä–µ–¥–∏—Ä–µ–∫—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ webhook

```typescript
// lib/enot.ts
export function verifyEnotWebhookSignature(payload: EnotWebhookPayload): boolean
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç MD5 –ø–æ–¥–ø–∏—Å—å –æ—Ç Enot.io
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç SECRET_KEY_2
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç true/false

### 3. –û–±—Ä–∞–±–æ—Ç–∫–∞ —É—Å–ø–µ—à–Ω–æ–≥–æ –ø–ª–∞—Ç–µ–∂–∞

**–ü—Ä–æ—Ü–µ—Å—Å –≤ `app/api/payment/webhook/route.ts`:**
1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏ ‚úÖ
2. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –ø–ª–∞—Ç–µ–∂–∞ –Ω–∞ "completed" ‚úÖ
3. –ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ‚úÖ
4. –°–æ–∑–¥–∞–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —Ç–∏–ø–∞ "payment" ‚úÖ
5. –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –∞–≤—Ç–æ-–ø—Ä–æ–¥–ª–µ–Ω–∏—è ‚úÖ
6. –ï—Å–ª–∏ –¥–∞ - —Å–ø–∏—Å–∞–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ –∏ –ø—Ä–æ–¥–ª–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏ ‚úÖ
7. –°–æ–∑–¥–∞–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —Ç–∏–ø–∞ "subscription" ‚úÖ

### 4. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–æ–¥–ª–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏

**–£—Å–ª–æ–≤–∏—è:**
- –£ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω `plan_id`
- –ü–æ–¥–ø–∏—Å–∫–∞ –∏—Å—Ç–µ–∫–ª–∞ (`subscription_expires < NOW()`)
- –ë–∞–ª–∞–Ω—Å–∞ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è –æ–ø–ª–∞—Ç—ã –ø–ª–∞–Ω–∞

**–î–µ–π—Å—Ç–≤–∏—è:**
- –°–ø–∏—Å–∞–Ω–∏–µ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –ø–ª–∞–Ω–∞ —Å –±–∞–ª–∞–Ω—Å–∞
- –ü—Ä–æ–¥–ª–µ–Ω–∏–µ `subscription_expires` –Ω–∞ 30 –¥–Ω–µ–π
- –°–æ–∑–¥–∞–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —Å –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–π —Å—É–º–º–æ–π

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –º–µ—Ä—ã

1. ‚úÖ **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏ webhook**
   - –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –æ—Ç Enot.io –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è SECRET_KEY_2
   - –ù–µ–≤–µ—Ä–Ω–∞—è –ø–æ–¥–ø–∏—Å—å = 401 –æ—Ç–≤–µ—Ç

2. ‚úÖ **Service Role Key**
   - –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ Supabase Service Role
   - –û–±—Ö–æ–¥ RLS –¥–ª—è —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

3. ‚úÖ **Idempotency**
   - –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ–¥–Ω–æ–≥–æ webhook –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ "pending" –ø–µ—Ä–µ–¥ –æ–±—Ä–∞–±–æ—Ç–∫–æ–π

4. ‚úÖ **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**
   - –í—Å–µ webhook –ª–æ–≥–∏—Ä—É—é—Ç—Å—è
   - –ü—Ä–µ—Ñ–∏–∫—Å `[Webhook]` –¥–ª—è —É–¥–æ–±–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞
   - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ–ª–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤ gateway_data

5. ‚úÖ **Error Handling**
   - –í—Å–µ –æ—à–∏–±–∫–∏ –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞—é—Ç—Å—è
   - –í–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ HTTP —Å—Ç–∞—Ç—É—Å—ã
   - –õ–æ–≥–∏—Ä—É—é—Ç—Å—è –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

## üìä –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ

```bash
./test_payment_webhook.sh
```

–°–∫—Ä–∏–ø—Ç –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç:
- –ó–∞–ø—É—Å–∫ Ngrok –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- –û—Ç–ø—Ä–∞–≤–∫—É —Ç–µ—Å—Ç–æ–≤—ã—Ö webhook
- –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
- –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ –º–µ–Ω—é

### –†—É—á–Ω–æ–µ

1. –°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –ø–ª–∞—Ç–µ–∂–∞ —á–µ—Ä–µ–∑ UI
2. –û–ø–ª–∞—Ç–∞ —á–µ—Ä–µ–∑ Enot.io (—Ç–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º)
3. –ü—Ä–æ–≤–µ—Ä–∫–∞ webhook
4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞ –∏ –ø–æ–¥–ø–∏—Å–∫–∏

### –ß–µ–∫–ª–∏—Å—Ç—ã

–°–º. `PAYMENT_SETUP_CHECKLIST.md` –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞ –ø—Ä–æ–≤–µ—Ä–æ–∫.

## üöÄ –î–µ–ø–ª–æ–π

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å:

```env
ENOT_SHOP_ID=your_shop_id
ENOT_SECRET_KEY=your_secret_key
ENOT_SECRET_KEY_2=your_secret_key_2
NEXT_PUBLIC_APP_URL=https://yourdomain.com
```

### Webhook URL

–í –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ Enot.io –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å:

```
https://yourdomain.com/api/payment/webhook
```

### –ú–∏–≥—Ä–∞—Ü–∏—è –ë–î

–í—ã–ø–æ–ª–Ω–∏—Ç—å –≤ Supabase SQL Editor:

```sql
-- –°–º. supabase/add_payment_external_id.sql
```

## üìà –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –õ–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞

–°–º–æ—Ç—Ä–∏—Ç–µ –ø—Ä–µ—Ñ–∏–∫—Å `[Webhook]`:

```
[Webhook] Received payload: {...}
[Webhook] Signature verified successfully
[Webhook] Processing payment xxx with status: success -> completed
[Webhook] Payment xxx marked as completed
[Webhook] Transaction created for user xxx, amount: 199
[Webhook] Subscription auto-renewed for user xxx
```

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

–ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ —Ç–∞–±–ª–∏—Ü—ã:
- `payments` - –≤—Å–µ –ø–ª–∞—Ç–µ–∂–∏ —Å–æ —Å—Ç–∞—Ç—É—Å–∞–º–∏
- `transactions` - –≤—Å–µ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
- `users` - –±–∞–ª–∞–Ω—Å –∏ subscription_expires

### Enot.io Dashboard

–ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ –≤ –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ:
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–ª–∞—Ç–µ–∂–µ–π
- –õ–æ–≥–∏ webhook
- –ë–∞–ª–∞–Ω—Å —Å—á—ë—Ç–∞

## üéì –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

### –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤

1. –ü—Ä–æ—á–∏—Ç–∞—Ç—å `PAYMENT_INTEGRATION.md`
2. –°–ª–µ–¥–æ–≤–∞—Ç—å `PAYMENT_SETUP_CHECKLIST.md`
3. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `test_payment_webhook.sh` –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
4. –ò–∑—É—á–∏—Ç—å –∫–æ–¥ –≤ `lib/enot.ts`

### –î–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤

1. –ü–æ–ª—É—á–∏—Ç—å API –∫–ª—é—á–∏ –≤ Enot.io
2. –î–æ–±–∞–≤–∏—Ç—å –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
3. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å webhook URL
4. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ —Ç–µ—Å—Ç–æ–≤–æ–º —Ä–µ–∂–∏–º–µ
5. –í–∫–ª—é—á–∏—Ç—å –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ

### –î–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

1. –û—Ç–∫—Ä—ã—Ç—å `/pay`
2. –í—ã–±—Ä–∞—Ç—å —Ç–∞—Ä–∏—Ñ
3. –í—ã–±—Ä–∞—Ç—å —Å–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã
4. –ù–∞–∂–∞—Ç—å "–ü–µ—Ä–µ–π—Ç–∏ –∫ –æ–ø–ª–∞—Ç–µ"
5. –û–ø–ª–∞—Ç–∏—Ç—å —á–µ—Ä–µ–∑ Enot.io
6. –ü–æ–ª—É—á–∏—Ç—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ

## üîß Troubleshooting

### Webhook –Ω–µ –ø—Ä–∏—Ö–æ–¥–∏—Ç

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å URL –≤ Enot.io
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ Ngrok (–¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)
3. –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –¥–æ—Å—Ç—É–ø–µ–Ω –ø—É–±–ª–∏—á–Ω–æ

### Invalid signature

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å ENOT_SECRET_KEY_2
2. –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –æ–Ω —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å –∫–ª—é—á–æ–º –≤ Enot.io
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ webhook payload

### –ë–∞–ª–∞–Ω—Å –Ω–µ –ø–æ–ø–æ–ª–Ω—è–µ—Ç—Å—è

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏: –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å "Transaction created"
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å RLS –ø–æ–ª–∏—Ç–∏–∫–∏ –≤ Supabase
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å SUPABASE_SERVICE_ROLE_KEY

–ü–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ –ø—Ä–æ–±–ª–µ–º –∏ —Ä–µ—à–µ–Ω–∏–π –≤ `PAYMENT_INTEGRATION.md` ‚Üí Troubleshooting.

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

| –§–∞–π–ª | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|----------|
| `PAYMENT_INTEGRATION.md` | –ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ |
| `PAYMENT_SETUP_CHECKLIST.md` | –ü–æ—à–∞–≥–æ–≤—ã–π —á–µ–∫–ª–∏—Å—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ |
| `PAYMENT_INTEGRATION_SUMMARY.md` | –û–±–∑–æ—Ä –≤—Å–µ—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π |
| `README.md` | –û–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π –≥–ª–∞–≤–Ω—ã–π README |

## üéâ –†–µ–∑—É–ª—å—Ç–∞—Ç

### –ë—ã–ª–æ

- ‚ùå Mock URL –¥–ª—è –ø–ª–∞—Ç–µ–∂–µ–π
- ‚ùå Webhook –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ø–∏—Å–∏
- ‚ùå –ù–µ—Ç –∞–≤—Ç–æ-–ø—Ä–æ–¥–ª–µ–Ω–∏—è
- ‚ùå –ù–µ—Ç —Å—Ç—Ä–∞–Ω–∏—Ü —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
- ‚ùå –ù–µ—Ç –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
- ‚ùå –ù–µ—Ç —Ç–µ—Å—Ç–æ–≤

### –°—Ç–∞–ª–æ

- ‚úÖ –ü–æ–ª–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Enot.io
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏ webhook
- ‚úÖ –ê–≤—Ç–æ-–ø—Ä–æ–¥–ª–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–æ–∫
- ‚úÖ –ö—Ä–∞—Å–∏–≤—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã —É—Å–ø–µ—Ö–∞/–æ—à–∏–±–∫–∏
- ‚úÖ 25+ —Å—Ç—Ä–∞–Ω–∏—Ü –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
- ‚úÖ –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —Ç–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç
- ‚úÖ Production-ready –∫–æ–¥

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:**
- –°–º. `PAYMENT_INTEGRATION.md`
- –°–º. `PAYMENT_SETUP_CHECKLIST.md`

**Enot.io:**
- support@enot.io
- Telegram: @enot_support

**–ü—Ä–æ–µ–∫—Ç:**
- GitHub Issues
- Telegram: @outlivion_support

---

## ‚ú® –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!

–í—Å–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∏–∑ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è **–≤—ã–ø–æ–ª–Ω–µ–Ω—ã –ø–æ–ª–Ω–æ—Å—Ç—å—é**.

–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è **–ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∞**, **–∑–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∞** –∏ **–≥–æ—Ç–æ–≤–∞ –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É**.

**–í—Ä–µ–º—è –Ω–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫—É:** ~2 —á–∞—Å–∞
**–°—Ç—Ä–æ–∫ –∫–æ–¥–∞:** ~1000+
**–§–∞–π–ª–æ–≤ —Å–æ–∑–¥–∞–Ω–æ:** 13
**–°—Ç—Ä–∞–Ω–∏—Ü –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏:** 25+

üöÄ **–ú–æ–∂–Ω–æ –¥–µ–ø–ª–æ–∏—Ç—å!**

---

**–î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è:** 25 –æ–∫—Ç—è–±—Ä—è 2025  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ COMPLETED  
**Quality:** Production Ready


#!/usr/bin/env python3
"""
–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ Supabase REST API
–ë–µ–∑ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –ø–∞—Ä–æ–ª—è PostgreSQL!
"""

import os
from pathlib import Path

SUPABASE_URL = os.getenv("TELEGRAM_BOT_SUPABASE_URL") or os.getenv("NEXT_PUBLIC_SUPABASE_URL", "")
PROJECT_REF = os.getenv("SUPABASE_PROJECT_REF")

if not PROJECT_REF and SUPABASE_URL:
    try:
        PROJECT_REF = SUPABASE_URL.replace("https://", "").split(".")[0]
    except IndexError:
        PROJECT_REF = "<your-project-ref>"
elif not PROJECT_REF:
    PROJECT_REF = "<your-project-ref>"

print("=" * 80)
print("üöÄ –°–û–ó–î–ê–ù–ò–ï SQL –§–ê–ô–õ–ê –î–õ–Ø –ò–ú–ü–û–†–¢–ê")
print("=" * 80)
print()

# –°–æ–∑–¥–∞—ë–º –µ–¥–∏–Ω—ã–π SQL —Ñ–∞–π–ª —Å–æ –≤—Å–µ–º –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–º
base_dir = Path(__file__).resolve().parent
schema_path = base_dir / 'supabase' / 'schema.sql'
function_path = base_dir / 'supabase' / 'generate_token_function.sql'

full_sql = schema_path.read_text()
function_sql = function_path.read_text()

complete_sql = full_sql + "\n\n" + function_sql

# –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ —Ñ–∞–π–ª –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞
output_file = base_dir / 'supabase' / 'complete_setup.sql'
output_file.write_text(complete_sql)

print(f"‚úÖ SQL —Ñ–∞–π–ª —Å–æ–∑–¥–∞–Ω: {output_file}")
print()
print("=" * 80)
print("üìã –ò–ù–°–¢–†–£–ö–¶–ò–Ø –ü–û –ò–ú–ü–û–†–¢–£")
print("=" * 80)
print()
print("1. –û—Ç–∫—Ä–æ–π—Ç–µ Supabase SQL Editor:")
print(f"   https://supabase.com/dashboard/project/{PROJECT_REF}/sql/new")
print()
print("2. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞:")
print(f"   cat {output_file}")
print()
print("3. –í—Å—Ç–∞–≤—å—Ç–µ –≤ SQL Editor –∏ –Ω–∞–∂–º–∏—Ç–µ RUN")
print()
print("4. –î–æ–∂–¥–∏—Ç–µ—Å—å —Å–æ–æ–±—â–µ–Ω–∏—è 'Success'")
print()
print("=" * 80)
print()
print("ü§ñ –ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –∑–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞:")
print("   cd telegram-bot && python3 bot.py")
print()
print("=" * 80)
print()

# –í—ã–≤–æ–¥–∏–º SQL –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è
print("üìÑ –ò–õ–ò –°–ö–û–ü–ò–†–£–ô–¢–ï –≠–¢–û–¢ SQL –ü–†–Ø–ú–û –°–ï–ô–ß–ê–°:")
print("=" * 80)
print()
print(complete_sql)
print()
print("=" * 80)
